{"Name":"Delete Row from Table","Description":"Given a row ID, delete it from the data table","Script":"from SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime, output_handler\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED,EXECUTION_STATE_TIMEDOUT\nimport TableManager\nimport google.auth.transport.requests\nfrom google.oauth2 import service_account\nimport json\nimport requests\n\nsiemplify = SiemplifyAction()\ntable = siemplify.extract_action_param(\"Data Table Name\", print_value=True)\nrow_id = siemplify.extract_action_param(\"Row ID\", print_value=True)\nsa_json = siemplify.extract_configuration_param('Integration',\"Service Account JSON\")\nsa_json = json.loads(sa_json)\nproject_name = siemplify.extract_configuration_param('Integration',\"GCP Project ID\")\nregion = siemplify.extract_configuration_param('Integration',\"GCP Region\")\ntenant = siemplify.extract_configuration_param('Integration',\"Google SecOps Tenant ID\")\n\n\n@output_handler\ndef main():\n    \n    # Create the endpoint url\n    API_BASE = \"https://\" + region + \"-chronicle.googleapis.com\"\n    PARENT = \"/v1alpha/projects/\" + project_name + \"/locations/\" + region + \"/instances/\" + tenant\n    URL = API_BASE + PARENT + \"/dataTables/\" + table + \"/dataTableRows/\" + row_id\n\n    # Attempt to load the data\n    credentials = service_account.Credentials.from_service_account_info(\n        sa_json, scopes=[\"https://www.googleapis.com/auth/cloud-platform\"]\n        )\n    request = google.auth.transport.requests.Request()\n    credentials.refresh(request)\n    hd = {\n      \"Authorization\": \"Bearer \" + credentials.token,\n      \"Content-Type\": \"application/json\"\n    }\n\n    # Check if the row exists (the API will return true even if the row doesn't exist)\n    if not row_id_exists(row_id, credentials.token):\n        output_message = \"Row \" + row_id + \" does not exist.\"\n        status = EXECUTION_STATE_FAILED\n        siemplify.LOGGER.error(output_message)\n        result_value = False\n        siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n        siemplify.end(output_message, result_value, status)\n\n\n    req = requests.delete(URL, headers=hd, timeout=30)\n    siemplify.LOGGER.info(req.text)\n\n    # If we get a create time, the row was added succesfully\n    if \"{}\" in req.text:\n        status = EXECUTION_STATE_COMPLETED\n        output_message = \"Successfully deleted row\"\n        result_value = True\n        siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n        siemplify.end(output_message, result_value, status)\n    else:\n        output_message = req.text\n        status = EXECUTION_STATE_FAILED\n        siemplify.LOGGER.error(output_message)\n        result_value = False\n        siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n        siemplify.end(output_message, result_value, status)\n\ndef row_id_exists(row_id, token):\n    c = TableManager.secops.get_datatable_json(sa_json,\n                                                project_name,\n                                                region,\n                                                tenant,\n                                                table,\n                                                siemplify)\n    for r in c:\n        if r['id'] == row_id:\n            return True\n    return False\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"Unofficial SecOps Data Tables","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{}","ShowResult":true}],"Creator":"036fe879-4c16-461e-b6d9-b1c552806fa0","IsEnabled":true,"IsCustom":true,"IsSystem":false,"Version":104.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"my_data_table","Description":"Name of the data table","Name":"Data Table Name","Value":"my_data_table","Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"abcde12345","Description":"Hex ID of the row to be deleted.","Name":"Row ID","Value":"abcde12345","Type":0,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","SimulationData":{"Entities":null},"SimulationDataJson":null}